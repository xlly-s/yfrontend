<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Downloader</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; text-align: center; }
    select, input, button { margin-top: 1rem; padding: 0.5rem; }
  </style>
</head>
<body>

  <h1>üé¨ YouTube Downloader</h1>
  <p>Auto downloads in best quality. Or pick your own resolution!</p>

  <input type="text" id="urlInput" placeholder="Enter YouTube URL" size="50">
  <br>
  <button onclick="fetchFormats()">Get Download Options</button>

  <div id="qualitySection" style="display:none;">
    <p><strong id="videoTitle"></strong></p>
    <select id="formatSelect"></select>
    <br>
    <button onclick="downloadSelected()">Download Selected</button>
  </div>

  <p id="status"></p>

  <script>
    let selectedFormats = [];

    async function fetchFormats() {
      const url = document.getElementById('urlInput').value;
      const status = document.getElementById('status');
      const select = document.getElementById('formatSelect');
      const title = document.getElementById('videoTitle');
      const section = document.getElementById('qualitySection');

      if (!url) return alert("Please enter a URL.");

      status.textContent = "Fetching available formats...";
      section.style.display = 'none';
      select.innerHTML = '';

      try {
        const res = await fetch('https://your-railway-url.com/formats', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });

        const data = await res.json();
        if (!data.formats || data.formats.length === 0) {
          status.textContent = "No formats found.";
          return;
        }

        selectedFormats = data.formats;
        title.textContent = data.title;

        data.formats.forEach(f => {
          const sizeMB = f.filesize ? (f.filesize / 1024 / 1024).toFixed(1) + ' MB' : 'Unknown size';
          const option = document.createElement('option');
          option.value = f.url;
          option.text = `${f.resolution}p - ${sizeMB}`;
          select.appendChild(option);
        });

        section.style.display = 'block';
        status.textContent = "";

      } catch (err) {
        status.textContent = "‚ùå Error: " + err.message;
      }
    }

    function downloadSelected() {
      const select = document.getElementById('formatSelect');
      const selectedURL = select.value;
      const title = document.getElementById('videoTitle').textContent;

      const link = document.createElement('a');
      link.href = selectedURL;
      link.download = `${title}.mp4`;
      link.target = '_blank';
      link.click();
    }
  </script>

</body>
</html>
